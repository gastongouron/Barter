<% title(@service.name, "Services") %>

<title>
  <% if content_for?(:title) %>
    <%= yield(:title) %>
  <% else %>
    Helper
  <% end %>
</title>
</div>
<div style='width: 100%'>
  <div id="map" style='width: 100%; height: 300px;'></div>
</div>

<div class="container">
<header class="panel-service">
  <span class="h1"><%= @service.name %></span><span class="pull-right"><span id="time" class="mustard h1"></span></span><br>
  <br>
  <span><b>Created by </b><%= @service.servicer_name %></span><br>
  <span><b>Created at </b><%= @service.created_at %></span><br>
  <span><b>Location </b><%= @service.location %></span><br>
  <span><b>Start </b><%= @service.start %></span><br>
  <span><b>Description </b><%= @service.description %></span>


  <ul class="actions marged">
  <% if current_user.id == @service.servicer_id %>
    <li><%= link_to "Edit Service", edit_service_path(@service),
    class: "edit" %></li>
    <li><%= link_to "Delete Service", service_path(@service),
     method: :delete,
     data: { confirm: "Are you sure you want to delete this service?" },
     class: "delete" %></li>
  <% end %>
  </ul>
</header>

<header class="panel-helps">
  <span class="h2">Current helps for this service</span>
  <ul class="actions">
    <% if current_user.id != @service.servicer_id && @service.helps.each {|help| help.owner > 0}  %>
    <li><%= link_to "New Help", new_service_help_path(@service), class: "new" %></li>
    <% end %>
  </ul>
</header>


<div id="helps">

  <% @service.helps.reverse.each do |help| %>

      <%= link_to help.name, [@service, help] %>
      <p><%= help.description %></p>
      <span id="author">Created by <b><%= help.user.email %></b></span>
      <% if current_user.id == @service.servicer_id && help.chosen == false %>
        <%= simple_form_for(@service) do %>
          <%= hidden_field(:service, :helper_id, :value => help.user.id) %>
          <%= hidden_field(:service, :owner, :value => help.user.id) %>
          <%= submit_tag("Service with this helper", class: "select pull-right") %>
        <% end %>

      <% elsif current_user.id == @service.servicer_id && help.chosen == true %>
        <%= simple_form_for(@service) do %>
          <%= hidden_field(:service, :helper_id, :value => help.user.id) %>
          <%= hidden_field(:service, :owner, :value => help.user.id) %>
          <%= submit_tag("Unpick", class: "select pull-right") %>
        <% end %>
      <% end %>
  <% end %>
</div>




<script>
function startTimer(duration, display) {
    var timer = duration, days, hours, minutes, seconds;
    setInterval(function () {
        days = parseInt(timer / 86400, 10);
        hours = parseInt((timer / 3600)%60, 10);
        minutes = parseInt((timer / 60)%60, 10);
        seconds = parseInt(timer % 60, 10);

        days = days < 10 ? "0" + days : days;
        hours = hours < 10 ? "0" + hours : hours;
        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        if (days > 0){
        display.textContent = "Starts in " + days + " days " + hours + ":" + minutes + ":" + seconds;
        }
        else {
          display.textContent = "Starts in " + hours + ":" + minutes + ":" + seconds;

        }

        if (--timer < 0) {
            timer = duration;
        }
    }, 1000);
}

window.onload = function () {
    var timeleft = <%= @cooldown %>,
        display = document.querySelector('#time');
        if (timeleft > 0)
          startTimer(timeleft, display);
        else
          display.textContent = "Over";
};

</script>

<script>
//handler = Gmaps.build('Google');
handler = Gmaps.build('Google', { markers: { maxRandomDistance: null } });
handler.buildMap({
  provider: {
    maxZoom: 18,
     styles: [
    {
        "featureType": "landscape",
        "stylers": [
            {
                "hue": "#FFAD00"
            },
            {
                "saturation": 50.2
            },
            {
                "lightness": -34.8
            },
            {
                "gamma": 1
            }
        ]
    },
    {
        "featureType": "road.highway",
        "stylers": [
            {
                "hue": "#FFAD00"
            },
            {
                "saturation": -19.8
            },
            {
                "lightness": -1.8
            },
            {
                "gamma": 1
            }
        ]
    },
    {
        "featureType": "road.arterial",
        "stylers": [
            {
                "hue": "#FFAD00"
            },
            {
                "saturation": 72.4
            },
            {
                "lightness": -32.6
            },
            {
                "gamma": 1
            }
        ]
    },
    {
        "featureType": "road.local",
        "stylers": [
            {
                "hue": "#FFAD00"
            },
            {
                "saturation": 74.4
            },
            {
                "lightness": -18
            },
            {
                "gamma": 1
            }
        ]
    },
    {
        "featureType": "water",
        "stylers": [
            {
                "hue": "#00FFA6"
            },
            {
                "saturation": -63.2
            },
            {
                "lightness": 38
            },
            {
                "gamma": 1
            }
        ]
    },
    {
        "featureType": "poi",
        "stylers": [
            {
                "hue": "#FFC300"
            },
            {
                "saturation": 54.2
            },
            {
                "lightness": -14.4
            },
            {
                "gamma": 1
            }
        ]
    }
],
  disableDefaultUI: true
  },
  internal: {id: 'map'}}, function(){

  markers = handler.addMarkers([
 {
  "lat": <%= @lat %>,
  "lng": <%= @lng %>,
    "picture": {
     "url": "http://icons.iconarchive.com/icons/glyphish/glyphish/32/59-flag-icon.png",
     "width":  32,
     "height": 32
        },
    }
  ]);
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();
});

</script>